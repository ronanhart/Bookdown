<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Database Structure | Master’s Thesis Research</title>
  <meta name="description" content="A recording of Ronan Hart’s master’s thesis project, from data collection to data analysis." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Database Structure | Master’s Thesis Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A recording of Ronan Hart’s master’s thesis project, from data collection to data analysis." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Database Structure | Master’s Thesis Research" />
  
  <meta name="twitter:description" content="A recording of Ronan Hart’s master’s thesis project, from data collection to data analysis." />
  

<meta name="author" content="Ronan Hart" />


<meta name="date" content="2021-03-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Master’s Thesis Project</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i><b>1.1</b> Abstract</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#questions"><i class="fa fa-check"></i><b>1.2</b> Questions</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#objectives"><i class="fa fa-check"></i><b>1.3</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="db-structure.html"><a href="db-structure.html"><i class="fa fa-check"></i><b>2</b> Database Structure</a>
<ul>
<li class="chapter" data-level="2.1" data-path="db-structure.html"><a href="db-structure.html#database-structure"><i class="fa fa-check"></i><b>2.1</b> Database Structure</a></li>
<li class="chapter" data-level="2.2" data-path="db-structure.html"><a href="db-structure.html#forming-the-database"><i class="fa fa-check"></i><b>2.2</b> Forming the Database</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="db-structure.html"><a href="db-structure.html#base-format"><i class="fa fa-check"></i><b>2.2.1</b> Base Format</a></li>
<li class="chapter" data-level="2.2.2" data-path="db-structure.html"><a href="db-structure.html#sort-into-different-datasets"><i class="fa fa-check"></i><b>2.2.2</b> Sort into Different Datasets</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="db-structure.html"><a href="db-structure.html#rsqlite"><i class="fa fa-check"></i><b>2.3</b> RSQLite</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Master’s Thesis Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="db_structure" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Database Structure</h1>
<div id="database-structure" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Database Structure</h2>
<p>To best structure all of my data, I will be storing my datasets into a database. My data will be in 3 main categories:</p>
<ul>
<li>GPS data from collared pronghorn and mule deer</li>
<li>Barrier locations and attributes (roads, fences, railroads, etc.)</li>
<li>Environmental covariates
<ul>
<li>Elevation</li>
<li>Landcover</li>
<li>Vegetation type and phenology</li>
<li>Snow depth</li>
</ul></li>
</ul>
<div class="figure" style="text-align: center">
<img src="Pictures/Directory%20Structure.png" alt="Directory Structure" width="70%" />
<p class="caption">
(#fig:dir_pic)Directory Structure
</p>
</div>
<p>The above picture shows my directory structure for this project. This directory reflects an Activity-based organization, with all the code stored in one folder, all the data stored in one folder, etc.</p>
<div class="figure" style="text-align: center">
<img src="Pictures/Database_Structure.jpg" alt="Database Structure" width="90%" />
<p class="caption">
(#fig:db_pic)Database Structure
</p>
</div>
<p>The above picture shows my database structure. Most of this database is of the GPS data from collared animals. The majority of data of barriers and environmental covariates will be in the form of shapefiles or rasters, and so were not included in this database structure.
<br></p>
</div>
<div id="forming-the-database" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Forming the Database</h2>
<p>Before I can begin working in RSQLite, I have to first format my raw data into a structure matching my planned structure above.</p>
<div class="figure" style="text-align: center">
<img src="Pictures/colnames.jpg" alt="Column Names of Raw Data" width="100%" />
<p class="caption">
(#fig:raw_dat_pic)Column Names of Raw Data
</p>
</div>
<p>To format my dataframes, I will be working with the packages <code>dplyr</code> – which allows me to manipulate dataframes – and <code>lubridate</code> – which allows me to work with date and time formats.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="db-structure.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Packages----</span></span>
<span id="cb1-2"><a href="db-structure.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-3"><a href="db-structure.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="db-structure.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Packages ----</span></span>
<span id="cb2-2"><a href="db-structure.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="db-structure.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p><br></p>
<div id="base-format" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Base Format</h3>
<p><em>Note: I want to apologize to seasoned R coders that I come from a python background and I refuse to use <code>&lt;-</code> as an assignment operator (too many keystrokes!). Instead, I use <code>=</code>.</em></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="db-structure.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Data ----</span></span>
<span id="cb3-2"><a href="db-structure.html#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/full_data.csv&quot;</span>)</span></code></pre></div>
<p><em>Note: For the purposes of this demonstration, I have subset my data and randomized certain elements</em></p>
<p>Let’s take a look at the data</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="db-structure.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre><code>##   X collarObjectId   species   dateYearAndJulian collarID  uniqueID mortality
## 1 1         171976 mule deer 2014-12-08 02:00:00    34895 MD13F0035     false
## 2 2         171977 mule deer 2014-12-08 14:00:00    34895 MD13F0035     false
## 3 3         171978 mule deer 2014-12-09 15:00:00    34895 MD13F0035     false
## 4 4         171979 mule deer 2014-12-10 04:00:00    34895 MD13F0035     false
## 5 5         171980 mule deer 2014-12-10 16:00:00    34895 MD13F0035     false
## 6 6         170147 mule deer 2014-12-13 00:00:00    30261 MD14F0046     false
##   sex currentAge latitude longitude currentCohort     freq projectName
## 1   F        2.5 40.61487 -109.2107         adult 150.7638        &lt;NA&gt;
## 2   F        2.5 40.60612 -109.1469         adult 150.6706        &lt;NA&gt;
## 3   F        2.5 41.05850 -109.1184         adult 151.9882        &lt;NA&gt;
## 4   F        2.5 41.08347 -109.0206         adult 152.9788        &lt;NA&gt;
## 5   F        2.5 41.18861 -108.8705         adult 150.2661        &lt;NA&gt;
## 6   F        5.0 41.16767 -111.6087         adult 155.0224        &lt;NA&gt;
##         captureUnit captureSubUnit birthYear realCaptureArea
## 1       South Slope    Diamond Mtn      2013         Diamond
## 2       South Slope    Diamond Mtn      2013         Diamond
## 3       South Slope    Diamond Mtn      2013         Diamond
## 4       South Slope    Diamond Mtn      2013         Diamond
## 5       South Slope    Diamond Mtn      2013         Diamond
## 6 Oquirrh-Stansbury           &lt;NA&gt;      2010     Pine Canyon</code></pre>
<p>First I need to format my full data into a base format:</p>
<ul>
<li>change datetime column to class <code>POSIXct</code></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="db-structure.html#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="db-structure.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column called &quot;dt&quot; (meaning &quot;datetime&quot;)</span></span>
<span id="cb6-3"><a href="db-structure.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dt =</span> <span class="fu">ymd_hms</span>(dateYearAndJulian))</span></code></pre></div>
<ul>
<li>change mortality to <code>logical</code> class</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="db-structure.html#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="db-structure.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mort =</span> <span class="fu">as.logical</span>(mortality))</span></code></pre></div>
<ul>
<li>add a record ID for each record</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="db-structure.html#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="db-structure.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_id =</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)))</span></code></pre></div>
<ul>
<li>rename columns to a preferred format</li>
<li>select only the needed columns.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="db-structure.html#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="db-structure.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rec_id, </span>
<span id="cb9-3"><a href="db-structure.html#cb9-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_id =</span> uniqueID,</span>
<span id="cb9-4"><a href="db-structure.html#cb9-4" aria-hidden="true" tabindex="-1"></a>         species,</span>
<span id="cb9-5"><a href="db-structure.html#cb9-5" aria-hidden="true" tabindex="-1"></a>         sex,</span>
<span id="cb9-6"><a href="db-structure.html#cb9-6" aria-hidden="true" tabindex="-1"></a>         dt,</span>
<span id="cb9-7"><a href="db-structure.html#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="co"># added y and x so I can remember which one is which</span></span>
<span id="cb9-8"><a href="db-structure.html#cb9-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">lat_y =</span> latitude,</span>
<span id="cb9-9"><a href="db-structure.html#cb9-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">lon_x =</span> longitude,</span>
<span id="cb9-10"><a href="db-structure.html#cb9-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">cohort =</span> currentCohort,</span>
<span id="cb9-11"><a href="db-structure.html#cb9-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">birth_year =</span> birthYear,</span>
<span id="cb9-12"><a href="db-structure.html#cb9-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">mortality =</span> mort,</span>
<span id="cb9-13"><a href="db-structure.html#cb9-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">capture_unit =</span> captureUnit,</span>
<span id="cb9-14"><a href="db-structure.html#cb9-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">collar_id =</span> collarID,</span>
<span id="cb9-15"><a href="db-structure.html#cb9-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">collar_obj_id =</span> collarObjectId,</span>
<span id="cb9-16"><a href="db-structure.html#cb9-16" aria-hidden="true" tabindex="-1"></a>         freq,</span>
<span id="cb9-17"><a href="db-structure.html#cb9-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">proj =</span> projectName)</span></code></pre></div>
<p>Let’s see what the data looks like now</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="db-structure.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre><code>##   rec_id animal_id   species sex                  dt    lat_y     lon_x cohort
## 1      1 MD13F0035 mule deer   F 2014-12-08 02:00:00 40.61487 -109.2107  adult
## 2      2 MD13F0035 mule deer   F 2014-12-08 14:00:00 40.60612 -109.1469  adult
## 3      3 MD13F0035 mule deer   F 2014-12-09 15:00:00 41.05850 -109.1184  adult
## 4      4 MD13F0035 mule deer   F 2014-12-10 04:00:00 41.08347 -109.0206  adult
## 5      5 MD13F0035 mule deer   F 2014-12-10 16:00:00 41.18861 -108.8705  adult
## 6      6 MD14F0046 mule deer   F 2014-12-13 00:00:00 41.16767 -111.6087  adult
##   birth_year mortality      capture_unit collar_id collar_obj_id     freq proj
## 1       2013     FALSE       South Slope     34895        171976 150.7638 &lt;NA&gt;
## 2       2013     FALSE       South Slope     34895        171977 150.6706 &lt;NA&gt;
## 3       2013     FALSE       South Slope     34895        171978 151.9882 &lt;NA&gt;
## 4       2013     FALSE       South Slope     34895        171979 152.9788 &lt;NA&gt;
## 5       2013     FALSE       South Slope     34895        171980 150.2661 &lt;NA&gt;
## 6       2010     FALSE Oquirrh-Stansbury     30261        170147 155.0224 &lt;NA&gt;</code></pre>
<p>Looks great!
<br></p>
</div>
<div id="sort-into-different-datasets" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Sort into Different Datasets</h3>
<p>Now I can begin to sort into the different datasets for my final database structure
<br></p>
<div id="individuals-dataset" class="section level4" number="2.2.2.1">
<h4><span class="header-section-number">2.2.2.1</span> Individuals Dataset</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="db-structure.html#cb12-1" aria-hidden="true" tabindex="-1"></a>indiv <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="db-structure.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, <span class="co"># this will be the primary key and a foreign key</span></span>
<span id="cb12-3"><a href="db-structure.html#cb12-3" aria-hidden="true" tabindex="-1"></a>         species,</span>
<span id="cb12-4"><a href="db-structure.html#cb12-4" aria-hidden="true" tabindex="-1"></a>         sex,</span>
<span id="cb12-5"><a href="db-structure.html#cb12-5" aria-hidden="true" tabindex="-1"></a>         birth_year,</span>
<span id="cb12-6"><a href="db-structure.html#cb12-6" aria-hidden="true" tabindex="-1"></a>         capture_unit) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="db-structure.html#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb12-8"><a href="db-structure.html#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="db-structure.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(indiv)</span></code></pre></div>
<pre><code>##   animal_id   species sex birth_year      capture_unit
## 1 MD13F0035 mule deer   F       2013       South Slope
## 2 MD14F0046 mule deer   F       2010 Oquirrh-Stansbury
## 3 MD11F0041 mule deer   F       2009 Oquirrh-Stansbury
## 4 MD12U0015 mule deer   U       2014 Oquirrh-Stansbury
## 5 MD14M0027 mule deer   M       2011         Box Elder</code></pre>
<p>This table now shows our individual animals and their sex, species, birth year, and the management unit where they were captured.</p>
<p>Now we can save this table for later. I’ll save it as a .rds file so that it keeps the format and datatypes and so it takes up less disk space.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="db-structure.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(indiv, <span class="st">&quot;Data/individual.rds&quot;</span>)</span></code></pre></div>
<p><br></p>
</div>
<div id="collar-dataset" class="section level4" number="2.2.2.2">
<h4><span class="header-section-number">2.2.2.2</span> Collar Dataset</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="db-structure.html#cb15-1" aria-hidden="true" tabindex="-1"></a>collar <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="db-structure.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(collar_id, <span class="co"># will be the primary key</span></span>
<span id="cb15-3"><a href="db-structure.html#cb15-3" aria-hidden="true" tabindex="-1"></a>         animal_id) <span class="sc">%&gt;%</span> <span class="co"># will be a foreign key</span></span>
<span id="cb15-4"><a href="db-structure.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="co"># make sure all records are distinct</span></span>
<span id="cb15-5"><a href="db-structure.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="db-structure.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(collar)</span></code></pre></div>
<pre><code>##   collar_id animal_id
## 1     34895 MD13F0035
## 2     30261 MD14F0046
## 3     34265 MD11F0041
## 4     32680 MD12U0015
## 5     33655 MD14M0027</code></pre>
<p>Now we have a table showing our animals and their collar IDs. In this subset of data, these 5 individuals had the same collar the whole time. But in my real dataset, there are some animals that had more than one collar. So instead of <code>collar_id</code> being stored with the “individuals” table, “collar” is its own table.</p>
<p>I’ll also save this as a .rds file</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="db-structure.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(collar, <span class="st">&quot;Data/collar.rds&quot;</span>)</span></code></pre></div>
<p><br></p>
</div>
<div id="location-dataset" class="section level4" number="2.2.2.3">
<h4><span class="header-section-number">2.2.2.3</span> Location Dataset</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="db-structure.html#cb18-1" aria-hidden="true" tabindex="-1"></a>gps <span class="ot">=</span>  df <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="db-structure.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column loc_id, a unique id for each location record</span></span>
<span id="cb18-3"><a href="db-structure.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loc_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df))) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="db-structure.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort into new df only with columns related to location data</span></span>
<span id="cb18-5"><a href="db-structure.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(loc_id, <span class="co"># this will be the primary key</span></span>
<span id="cb18-6"><a href="db-structure.html#cb18-6" aria-hidden="true" tabindex="-1"></a>         animal_id, <span class="co"># this will be a foreign key</span></span>
<span id="cb18-7"><a href="db-structure.html#cb18-7" aria-hidden="true" tabindex="-1"></a>         dt,</span>
<span id="cb18-8"><a href="db-structure.html#cb18-8" aria-hidden="true" tabindex="-1"></a>         lat_y,</span>
<span id="cb18-9"><a href="db-structure.html#cb18-9" aria-hidden="true" tabindex="-1"></a>         lon_x)</span>
<span id="cb18-10"><a href="db-structure.html#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="db-structure.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gps)</span></code></pre></div>
<pre><code>##   loc_id animal_id                  dt    lat_y     lon_x
## 1      1 MD13F0035 2014-12-08 02:00:00 40.61487 -109.2107
## 2      2 MD13F0035 2014-12-08 14:00:00 40.60612 -109.1469
## 3      3 MD13F0035 2014-12-09 15:00:00 41.05850 -109.1184
## 4      4 MD13F0035 2014-12-10 04:00:00 41.08347 -109.0206
## 5      5 MD13F0035 2014-12-10 16:00:00 41.18861 -108.8705
## 6      6 MD14F0046 2014-12-13 00:00:00 41.16767 -111.6087</code></pre>
<p>For the Location datset, I also need to add a column for UTM x and UTM y. My study area is in Utah, which is UTM Zone 12N. To convert to UTM, I need to use the package <code>sf</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="db-structure.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Packages ----</span></span>
<span id="cb20-2"><a href="db-structure.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="db-structure.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Packages</span></span>
<span id="cb21-2"><a href="db-structure.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<p>But because my (real) dataset of location data is very large, I want to convert this data piece by piece so R can handle it better. So instead of converting all at once, I will convert by year. To make this easier, I’ll create a function to convert given latitude and longitude coordinates to UTM.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="db-structure.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to Convert Lat Long to UTM Zone 12N----</span></span>
<span id="cb22-2"><a href="db-structure.html#cb22-2" aria-hidden="true" tabindex="-1"></a>convert_UTM <span class="ot">=</span> <span class="cf">function</span>(latlon_df){</span>
<span id="cb22-3"><a href="db-structure.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  utm_df <span class="ot">=</span> latlon_df <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="db-structure.html#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># turns df into sf object with geometry</span></span>
<span id="cb22-5"><a href="db-structure.html#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon_x&quot;</span>, <span class="st">&quot;lat_y&quot;</span>),</span>
<span id="cb22-6"><a href="db-structure.html#cb22-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> <span class="co"># WGS84 = EPSG 4326</span></span>
<span id="cb22-7"><a href="db-structure.html#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># converts geometry to UTM 12N projection </span></span>
<span id="cb22-8"><a href="db-structure.html#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">32612</span>) <span class="sc">%&gt;%</span> <span class="co"># UTM 12N = EPSG 32612</span></span>
<span id="cb22-9"><a href="db-structure.html#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creates a new column of x and y UTM 12N coordinates</span></span>
<span id="cb22-10"><a href="db-structure.html#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">utm_x =</span> <span class="fu">st_coordinates</span>(.)[, <span class="dv">1</span>],</span>
<span id="cb22-11"><a href="db-structure.html#cb22-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">utm_y =</span> <span class="fu">st_coordinates</span>(.)[, <span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="db-structure.html#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drops geometry column</span></span>
<span id="cb22-13"><a href="db-structure.html#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>()</span>
<span id="cb22-14"><a href="db-structure.html#cb22-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-15"><a href="db-structure.html#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(utm_df)</span>
<span id="cb22-16"><a href="db-structure.html#cb22-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-17"><a href="db-structure.html#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="db-structure.html#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to UTM ----</span></span>
<span id="cb22-19"><a href="db-structure.html#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># My location dataset is very large</span></span>
<span id="cb22-20"><a href="db-structure.html#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># So I&#39;ll break it by year, convert, then bind together</span></span>
<span id="cb22-21"><a href="db-structure.html#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="db-structure.html#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co"># make vector of range of dates</span></span>
<span id="cb22-23"><a href="db-structure.html#cb22-23" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">year</span>(gps<span class="sc">$</span>dt))<span class="sc">:</span><span class="fu">max</span>(<span class="fu">year</span>(gps<span class="sc">$</span>dt))</span>
<span id="cb22-24"><a href="db-structure.html#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="db-structure.html#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co"># empty dataframe for all UTM data</span></span>
<span id="cb22-26"><a href="db-structure.html#cb22-26" aria-hidden="true" tabindex="-1"></a>utm <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb22-27"><a href="db-structure.html#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="db-structure.html#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co"># iterates over every date</span></span>
<span id="cb22-29"><a href="db-structure.html#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dates)){</span>
<span id="cb22-30"><a href="db-structure.html#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># temporary dataframe to store current year&#39;s utm </span></span>
<span id="cb22-31"><a href="db-structure.html#cb22-31" aria-hidden="true" tabindex="-1"></a>  utm_temp <span class="ot">=</span> gps <span class="sc">%&gt;%</span></span>
<span id="cb22-32"><a href="db-structure.html#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter latlon dataframe by date</span></span>
<span id="cb22-33"><a href="db-structure.html#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">year</span>(dt) <span class="sc">==</span> dates[i]) <span class="sc">%&gt;%</span></span>
<span id="cb22-34"><a href="db-structure.html#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert to utm</span></span>
<span id="cb22-35"><a href="db-structure.html#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_UTM</span>()</span>
<span id="cb22-36"><a href="db-structure.html#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bind new utm to full utm</span></span>
<span id="cb22-37"><a href="db-structure.html#cb22-37" aria-hidden="true" tabindex="-1"></a>  utm <span class="ot">=</span> <span class="fu">rbind</span>(utm, utm_temp)</span>
<span id="cb22-38"><a href="db-structure.html#cb22-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-39"><a href="db-structure.html#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="db-structure.html#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(utm)</span></code></pre></div>
<pre><code>##   loc_id animal_id                  dt    utm_x   utm_y
## 1      1 MD13F0035 2014-12-08 02:00:00 651359.4 4497544
## 2      2 MD13F0035 2014-12-08 14:00:00 656774.1 4496684
## 3      3 MD13F0035 2014-12-09 15:00:00 658105.5 4546956
## 4      4 MD13F0035 2014-12-10 04:00:00 666261.1 4549910
## 5      5 MD13F0035 2014-12-10 16:00:00 678585.6 4561881
## 6      6 MD14F0046 2014-12-13 00:00:00 448935.4 4557549</code></pre>
<p>After that year’s coordinates are converted, the data will be bound into a final dataframe and then joined with the gps table to make the final location dataset.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="db-structure.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join ----</span></span>
<span id="cb24-2"><a href="db-structure.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># join gps with utm by the unique location id</span></span>
<span id="cb24-3"><a href="db-structure.html#cb24-3" aria-hidden="true" tabindex="-1"></a>loc <span class="ot">=</span> <span class="fu">inner_join</span>(gps, utm, <span class="at">by =</span> <span class="st">&quot;loc_id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="db-structure.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the extra columns (it creates &quot;animal_id.x&quot; etc)</span></span>
<span id="cb24-5"><a href="db-structure.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(loc_id, <span class="at">animal_id =</span> animal_id.x, <span class="at">dt =</span> dt.x, lat_y, lon_x, utm_x, utm_y)</span>
<span id="cb24-6"><a href="db-structure.html#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="db-structure.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(loc)</span></code></pre></div>
<pre><code>##   loc_id animal_id                  dt    lat_y     lon_x    utm_x   utm_y
## 1      1 MD13F0035 2014-12-08 02:00:00 40.61487 -109.2107 651359.4 4497544
## 2      2 MD13F0035 2014-12-08 14:00:00 40.60612 -109.1469 656774.1 4496684
## 3      3 MD13F0035 2014-12-09 15:00:00 41.05850 -109.1184 658105.5 4546956
## 4      4 MD13F0035 2014-12-10 04:00:00 41.08347 -109.0206 666261.1 4549910
## 5      5 MD13F0035 2014-12-10 16:00:00 41.18861 -108.8705 678585.6 4561881
## 6      6 MD14F0046 2014-12-13 00:00:00 41.16767 -111.6087 448935.4 4557549</code></pre>
<p>Let’s save this table, again as a .rds file.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="db-structure.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save ----</span></span>
<span id="cb26-2"><a href="db-structure.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(loc, <span class="st">&quot;Data/location.rds&quot;</span>)</span></code></pre></div>
<p><br></p>
</div>
<div id="deployment-dataset" class="section level4" number="2.2.2.4">
<h4><span class="header-section-number">2.2.2.4</span> Deployment Dataset</h4>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="db-structure.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pull out distinct animal id</span></span>
<span id="cb27-2"><a href="db-structure.html#cb27-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="db-structure.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(animal_id)</span>
<span id="cb27-4"><a href="db-structure.html#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="db-structure.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># make empty dataframe</span></span>
<span id="cb27-6"><a href="db-structure.html#cb27-6" aria-hidden="true" tabindex="-1"></a>deploy <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb27-7"><a href="db-structure.html#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="db-structure.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate over every id</span></span>
<span id="cb27-9"><a href="db-structure.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(id)){</span>
<span id="cb27-10"><a href="db-structure.html#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a temp df</span></span>
<span id="cb27-11"><a href="db-structure.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="db-structure.html#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pull out specific individual</span></span>
<span id="cb27-13"><a href="db-structure.html#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(animal_id <span class="sc">==</span> id[i, ]) <span class="sc">%&gt;%</span></span>
<span id="cb27-14"><a href="db-structure.html#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate start and end date for that individual, make into a column each</span></span>
<span id="cb27-15"><a href="db-structure.html#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">start_dt =</span> <span class="fu">min</span>(dt),</span>
<span id="cb27-16"><a href="db-structure.html#cb27-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">end_dt =</span> <span class="fu">max</span>(dt)) <span class="sc">%&gt;%</span></span>
<span id="cb27-17"><a href="db-structure.html#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># shorten to just one record of the individual and its start and end date</span></span>
<span id="cb27-18"><a href="db-structure.html#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(animal_id, <span class="co"># this is a foreign key</span></span>
<span id="cb27-19"><a href="db-structure.html#cb27-19" aria-hidden="true" tabindex="-1"></a>           start_dt,</span>
<span id="cb27-20"><a href="db-structure.html#cb27-20" aria-hidden="true" tabindex="-1"></a>           end_dt)</span>
<span id="cb27-21"><a href="db-structure.html#cb27-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-22"><a href="db-structure.html#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bind into the final deploy df</span></span>
<span id="cb27-23"><a href="db-structure.html#cb27-23" aria-hidden="true" tabindex="-1"></a>  deploy <span class="ot">=</span> <span class="fu">rbind</span>(deploy, temp)</span>
<span id="cb27-24"><a href="db-structure.html#cb27-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-25"><a href="db-structure.html#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the temp df</span></span>
<span id="cb27-26"><a href="db-structure.html#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(temp)</span>
<span id="cb27-27"><a href="db-structure.html#cb27-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-28"><a href="db-structure.html#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="db-structure.html#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(deploy)</span></code></pre></div>
<pre><code>##   animal_id            start_dt              end_dt
## 1 MD13F0035 2014-12-08 02:00:00 2014-12-10 16:00:00
## 2 MD14F0046 2014-12-13 00:00:00 2014-12-15 14:00:00
## 3 MD11F0041 2014-12-12 00:00:00 2014-12-14 00:00:00
## 4 MD12U0015 2014-12-15 11:00:00 2014-12-18 14:00:00
## 5 MD14M0027 2014-04-03 10:22:29 2014-04-03 12:24:08</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="db-structure.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(deploy, <span class="st">&quot;Data/deployment.rds&quot;</span>)</span></code></pre></div>
<p><br></p>
</div>
</div>
</div>
<div id="rsqlite" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> RSQLite</h2>
<p>Now that I’ve formatted all my datasets, it’s time to put them together in a database.</p>
<p>To form this database, I will be working in with the package <code>RSQLite</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="db-structure.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Packages----</span></span>
<span id="cb30-2"><a href="db-structure.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;RSQLite&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="db-structure.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Packages----</span></span>
<span id="cb31-2"><a href="db-structure.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span></code></pre></div>
<p>Once the package is installed and loaded, I can begin working in RSQLite. First, I need to create the database.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="db-structure.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Establish Database Connection ----</span></span>
<span id="cb32-2"><a href="db-structure.html#cb32-2" aria-hidden="true" tabindex="-1"></a>db <span class="ot">=</span> <span class="fu">dbConnect</span>(<span class="at">drv =</span> RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">&quot;Data/barrier_proj.db&quot;</span>)</span></code></pre></div>
<p>Then, I need to create the tables for all of my datasets. I need to create the <code>individuals</code> table first because it has no foreign key but its primary key (<code>animal_id</code>) is a foreign key for the other tables.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="db-structure.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(db, </span>
<span id="cb33-2"><a href="db-structure.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CREATE TABLE individuals(</span></span>
<span id="cb33-3"><a href="db-structure.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="st">  animal_id char(9) NOT NULL PRIMARY KEY,</span></span>
<span id="cb33-4"><a href="db-structure.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="st">  species char(8), </span></span>
<span id="cb33-5"><a href="db-structure.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="st">  sex char(1) CHECK (sex IN (&#39;M&#39;, &#39;F&#39;, &#39;U&#39;)),</span></span>
<span id="cb33-6"><a href="db-structure.html#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="st">  birth_year integer,</span></span>
<span id="cb33-7"><a href="db-structure.html#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="st">  capture_unit varchar(20)</span></span>
<span id="cb33-8"><a href="db-structure.html#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="st">  );&quot;</span>)</span></code></pre></div>
<p>I made <code>animal_id</code> of class <code>char</code> instead of <code>varchar</code> because every ID follows the same format: SPYYSXXXX</p>
<ul>
<li>SP = species abbreviation (MD or PR)</li>
<li>YY = year captured</li>
<li>S = sex</li>
<li>XXXX = incremental unit</li>
</ul>
<p>For example, the 10th female mule deer captured in 2017 would have an id MD17F0010</p>
<p>Fortunately, both “pronghorn” and “mule deer” have the same number of characters (8), so I can make <code>species</code> a <code>char</code> class instead of <code>varchar</code>.</p>
<p>Let’s check that the table was built ok. Since I didn’t put any data yet, it should be empty.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="db-structure.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(<span class="at">conn =</span> db, <span class="at">statement =</span> <span class="st">&quot;SELECT * FROM individuals;&quot;</span>)</span></code></pre></div>
<pre><code>##   animal_id   species sex birth_year      capture_unit
## 1 MD13F0035 mule deer   F       2013       South Slope
## 2 MD14F0046 mule deer   F       2010 Oquirrh-Stansbury
## 3 MD11F0041 mule deer   F       2009 Oquirrh-Stansbury
## 4 MD12U0015 mule deer   U       2014 Oquirrh-Stansbury
## 5 MD14M0027 mule deer   M       2011         Box Elder</code></pre>
<p>Awesome! Now I can create the other tables that use <code>animal_id</code> as a foreign key.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="db-structure.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(db, </span>
<span id="cb36-2"><a href="db-structure.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CREATE TABLE collar(</span></span>
<span id="cb36-3"><a href="db-structure.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="st">  collar_id integer NOT NULL PRIMARY KEY,</span></span>
<span id="cb36-4"><a href="db-structure.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="st">  animal_id char(9), </span></span>
<span id="cb36-5"><a href="db-structure.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="st">  FOREIGN KEY (animal_id) REFERENCES individuals(animal_id)</span></span>
<span id="cb36-6"><a href="db-structure.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="st">  );&quot;</span>)</span>
<span id="cb36-7"><a href="db-structure.html#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="db-structure.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(db, </span>
<span id="cb36-9"><a href="db-structure.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CREATE TABLE location(</span></span>
<span id="cb36-10"><a href="db-structure.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="st">  loc_id integer NOT NULL PRIMARY KEY,</span></span>
<span id="cb36-11"><a href="db-structure.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="st">  animal_id char(9),</span></span>
<span id="cb36-12"><a href="db-structure.html#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="st">  dt text,</span></span>
<span id="cb36-13"><a href="db-structure.html#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="st">  lat_y double, </span></span>
<span id="cb36-14"><a href="db-structure.html#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="st">  lon_x double,</span></span>
<span id="cb36-15"><a href="db-structure.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="st">  utm_x double,</span></span>
<span id="cb36-16"><a href="db-structure.html#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="st">  utm_y double,</span></span>
<span id="cb36-17"><a href="db-structure.html#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="st">  FOREIGN KEY (animal_id) REFERENCES individuals(animal_id)</span></span>
<span id="cb36-18"><a href="db-structure.html#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="st">  );&quot;</span>)</span>
<span id="cb36-19"><a href="db-structure.html#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="db-structure.html#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(db, </span>
<span id="cb36-21"><a href="db-structure.html#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CREATE TABLE deployment(</span></span>
<span id="cb36-22"><a href="db-structure.html#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="st">  deploy_id INTEGER PRIMARY KEY AUTOINCREMENT,</span></span>
<span id="cb36-23"><a href="db-structure.html#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="st">  animal_id char(9),</span></span>
<span id="cb36-24"><a href="db-structure.html#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="st">  start_dt text,</span></span>
<span id="cb36-25"><a href="db-structure.html#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="st">  end_dt text,</span></span>
<span id="cb36-26"><a href="db-structure.html#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="st">  FOREIGN KEY (animal_id) REFERENCES individuals(animal_id)</span></span>
<span id="cb36-27"><a href="db-structure.html#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="st">  );&quot;</span>)</span></code></pre></div>
<p>After the tables are created, all I need to do is import the data into the database.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="db-structure.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(db, <span class="st">&quot;individuals&quot;</span>, indiv, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-2"><a href="db-structure.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="db-structure.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(db, <span class="st">&quot;collar&quot;</span>, collar, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-4"><a href="db-structure.html#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="db-structure.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(db, <span class="st">&quot;location&quot;</span>, loc, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-6"><a href="db-structure.html#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="db-structure.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(db, <span class="st">&quot;deployment&quot;</span>, deploy, <span class="at">append =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>And check that everything loaded in correctly</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="db-structure.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(<span class="at">conn =</span> db, <span class="at">statement =</span> <span class="st">&quot;SELECT * FROM individuals LIMIT 10;&quot;</span>)</span></code></pre></div>
<pre><code>##   animal_id   species sex birth_year      capture_unit
## 1 MD13F0035 mule deer   F       2013       South Slope
## 2 MD14F0046 mule deer   F       2010 Oquirrh-Stansbury
## 3 MD11F0041 mule deer   F       2009 Oquirrh-Stansbury
## 4 MD12U0015 mule deer   U       2014 Oquirrh-Stansbury
## 5 MD14M0027 mule deer   M       2011         Box Elder</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="db-structure.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(<span class="at">conn =</span> db, <span class="at">statement =</span> <span class="st">&quot;SELECT * FROM collar LIMIT 10;&quot;</span>)</span></code></pre></div>
<pre><code>##   collar_id animal_id
## 1     30261 MD14F0046
## 2     32680 MD12U0015
## 3     33655 MD14M0027
## 4     34265 MD11F0041
## 5     34895 MD13F0035</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="db-structure.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(<span class="at">conn =</span> db, <span class="at">statement =</span> <span class="st">&quot;SELECT * FROM location LIMIT 10;&quot;</span>)</span></code></pre></div>
<pre><code>##    loc_id animal_id           dt    lat_y     lon_x    utm_x   utm_y
## 1       1 MD13F0035 1418004000.0 40.61487 -109.2107 651359.4 4497544
## 2       2 MD13F0035 1418047200.0 40.60612 -109.1469 656774.1 4496684
## 3       3 MD13F0035 1418137200.0 41.05850 -109.1184 658105.5 4546956
## 4       4 MD13F0035 1418184000.0 41.08347 -109.0206 666261.1 4549910
## 5       5 MD13F0035 1418227200.0 41.18861 -108.8705 678585.6 4561881
## 6       6 MD14F0046 1418428800.0 41.16767 -111.6087 448935.4 4557549
## 7       7 MD14F0046 1418472000.0 41.35899 -111.5288 455769.7 4578745
## 8       8 MD14F0046 1418518800.0 40.88203 -112.2252 396772.7 4526384
## 9       9 MD14F0046 1418608800.0 41.43313 -111.7143 440319.6 4587086
## 10     10 MD14F0046 1418652000.0 41.45278 -111.3427 471376.1 4589079</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="db-structure.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(<span class="at">conn =</span> db, <span class="at">statement =</span> <span class="st">&quot;SELECT * FROM deployment LIMIT 10;&quot;</span>)</span></code></pre></div>
<pre><code>##   deploy_id animal_id     start_dt       end_dt
## 1         1 MD13F0035 1418004000.0 1418227200.0
## 2         2 MD14F0046 1418428800.0 1418652000.0
## 3         3 MD11F0041 1418342400.0 1418515200.0
## 4         4 MD12U0015 1418641200.0 1418911200.0
## 5         5 MD14M0027 1396520549.0 1396527848.0</code></pre>
<p>Hooray! My database has been created!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Bookdown.pdf", "Bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
