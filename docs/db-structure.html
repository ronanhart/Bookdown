<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Database Structure | Master’s Thesis Research</title>
  <meta name="description" content="A recording of Ronan Hart’s master’s thesis project, from data collection to data analysis." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Database Structure | Master’s Thesis Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A recording of Ronan Hart’s master’s thesis project, from data collection to data analysis." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Database Structure | Master’s Thesis Research" />
  
  <meta name="twitter:description" content="A recording of Ronan Hart’s master’s thesis project, from data collection to data analysis." />
  

<meta name="author" content="Ronan Hart" />


<meta name="date" content="2021-04-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="overview.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Ronan Hart's Final Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#project-outline"><i class="fa fa-check"></i><b>1.1</b> Project Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Project Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#abstract"><i class="fa fa-check"></i><b>2.1</b> Abstract</a></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#research-question"><i class="fa fa-check"></i><b>2.2</b> Research Question</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#objectives"><i class="fa fa-check"></i><b>2.3</b> Objectives</a></li>
<li class="chapter" data-level="2.4" data-path="overview.html"><a href="overview.html#hypotheses-and-predictions"><i class="fa fa-check"></i><b>2.4</b> Hypotheses and Predictions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="db-structure.html"><a href="db-structure.html"><i class="fa fa-check"></i><b>3</b> Database Structure</a>
<ul>
<li class="chapter" data-level="3.1" data-path="db-structure.html"><a href="db-structure.html#database-structure"><i class="fa fa-check"></i><b>3.1</b> Database Structure</a></li>
<li class="chapter" data-level="3.2" data-path="db-structure.html"><a href="db-structure.html#formatting-data"><i class="fa fa-check"></i><b>3.2</b> Formatting Data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="db-structure.html"><a href="db-structure.html#base-format"><i class="fa fa-check"></i><b>3.2.1</b> Base Format</a></li>
<li class="chapter" data-level="3.2.2" data-path="db-structure.html"><a href="db-structure.html#sort-into-different-datasets"><i class="fa fa-check"></i><b>3.2.2</b> Sort into Different Datasets</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="db-structure.html"><a href="db-structure.html#rsqlite"><i class="fa fa-check"></i><b>3.3</b> RSQLite</a></li>
<li class="chapter" data-level="3.4" data-path="db-structure.html"><a href="db-structure.html#locoh-home-range-for-one-season"><i class="fa fa-check"></i><b>3.4</b> LoCoH Home Range for One Season</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="db-structure.html"><a href="db-structure.html#delineate-seasonal-locoh-hull"><i class="fa fa-check"></i><b>3.4.1</b> Delineate Seasonal LoCoH Hull</a></li>
<li class="chapter" data-level="3.4.2" data-path="db-structure.html"><a href="db-structure.html#plot-home-range"><i class="fa fa-check"></i><b>3.4.2</b> Plot Home Range</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="db-structure.html"><a href="db-structure.html#locoh-home-range-for-all-seasons-in-all-years"><i class="fa fa-check"></i><b>3.5</b> LoCoH Home Range for all seasons in all years</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="db-structure.html"><a href="db-structure.html#home-range-area"><i class="fa fa-check"></i><b>3.5.1</b> Home Range Area</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Master’s Thesis Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="db_structure" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Database Structure</h1>
<div id="database-structure" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Database Structure</h2>
<p>To best structure all of my data, I will be storing my datasets into a database. My data will be in 3 main categories:</p>
<ul>
<li>GPS data from collared pronghorn and mule deer</li>
<li>Barrier locations and attributes (roads, fences, railroads, etc.)</li>
<li>Environmental covariates
<ul>
<li>Elevation</li>
<li>Landcover</li>
<li>Vegetation type and phenology</li>
<li>Snow depth</li>
</ul></li>
</ul>
<div class="figure" style="text-align: center">
<img src="Pictures/Directory_Structure.png" alt="Directory Structure" width="70%" />
<p class="caption">
(#fig:dir_pic)Directory Structure
</p>
</div>
<p>The above picture shows my directory structure for this project. This directory reflects an Activity-based organization, with all the code stored in one folder, all the data stored in one folder, etc.</p>
<div class="figure" style="text-align: center">
<img src="Pictures/Database_Structure.jpg" alt="Database Structure" width="90%" />
<p class="caption">
(#fig:db_pic)Database Structure
</p>
</div>
<p>The above picture shows my database structure. This database is of the GPS data from collared animals. The majority of data of barriers and environmental covariates will be in the form of shapefiles or rasters, and so were not included in this database structure.
<br></p>
</div>
<div id="formatting-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Formatting Data</h2>
<p>Before I can begin working in RSQLite, I have to first format my raw data into a structure matching my planned structure above.</p>
<p>To format my dataframes, I will be working with the packages <code>dplyr</code> – which allows me to manipulate dataframes – and <code>lubridate</code> – which allows me to work with date and time formats.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="db-structure.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-2"><a href="db-structure.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="db-structure.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="db-structure.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p><br></p>
<div id="base-format" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Base Format</h3>
<p>I need to:</p>
<ol style="list-style-type: decimal">
<li>Change the Date and Time column to class <code>POSIXct</code> instead of <code>character</code>. I can do this using <code>lubridate</code>’s function <code>ymd_hms()</code></li>
<li>Change the mortality column to class <code>logical</code>, since the values are either <code>TRUE</code> or <code>FALSE</code></li>
<li>Change the Collar ID column. Some Collar ID records are a different character length, so some have a 0 in front while others do not. This makes it seem like there are more collars deployed than in reality. So I need to check the number of characters in the Collar ID column and add a 0 if there are too few.</li>
<li>Remove quotes around Animal IDs. There is at least one Animal ID record that has quotes around it while the others do not, so I want to remove these quotes.</li>
<li>Rename the columns to the name format I prefer and sort them into an order I feel is more useful. (This part is only for aesthetics and consistency for me)</li>
</ol>
<p>I’ve written all of these steps into a useable funciton, so all I need to do is plug in a dataframe as an argument and all of these formatting processes will happen at once.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="db-structure.html#cb3-1" aria-hidden="true" tabindex="-1"></a>base_format <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb3-2"><a href="db-structure.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CHANGE DATE</span></span>
<span id="cb3-3"><a href="db-structure.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DateAndTime is character class, needs to be date</span></span>
<span id="cb3-4"><a href="db-structure.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Changing date format...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="co"># print so user knows what step</span></span>
<span id="cb3-5"><a href="db-structure.html#cb3-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="db-structure.html#cb3-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">datetime =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hms</span>(DateAndTime))</span>
<span id="cb3-7"><a href="db-structure.html#cb3-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-8"><a href="db-structure.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CHANGE MORTALITY</span></span>
<span id="cb3-9"><a href="db-structure.html#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mortality is character class, change to logical</span></span>
<span id="cb3-10"><a href="db-structure.html#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Changing mortality format...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="co"># print so user knows what step</span></span>
<span id="cb3-11"><a href="db-structure.html#cb3-11" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="db-structure.html#cb3-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mort =</span> <span class="fu">as.logical</span>(Mortality))</span>
<span id="cb3-13"><a href="db-structure.html#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="db-structure.html#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CHANGE COLLAR ID</span></span>
<span id="cb3-15"><a href="db-structure.html#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adds a 0 in front to make sure they&#39;re all the same length</span></span>
<span id="cb3-16"><a href="db-structure.html#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># removes the issue of duplicates where one collar ID had a 0 and one didn&#39;t</span></span>
<span id="cb3-17"><a href="db-structure.html#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Changing collar ID format...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="co"># print so user knows what step</span></span>
<span id="cb3-18"><a href="db-structure.html#cb3-18" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="db-structure.html#cb3-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-20"><a href="db-structure.html#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">collar_id =</span> <span class="fu">case_when</span>(<span class="fu">nchar</span>(CollarID) <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, CollarID),</span>
<span id="cb3-21"><a href="db-structure.html#cb3-21" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">nchar</span>(CollarID) <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot;00&quot;</span>, CollarID),</span>
<span id="cb3-22"><a href="db-structure.html#cb3-22" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> CollarID)</span>
<span id="cb3-23"><a href="db-structure.html#cb3-23" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-24"><a href="db-structure.html#cb3-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-25"><a href="db-structure.html#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># REMOVING QUOTES</span></span>
<span id="cb3-26"><a href="db-structure.html#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there&#39;s a record in AnimalID that has quotes around the id</span></span>
<span id="cb3-27"><a href="db-structure.html#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Removing quotes...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="co"># print so user knows what step</span></span>
<span id="cb3-28"><a href="db-structure.html#cb3-28" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-29"><a href="db-structure.html#cb3-29" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">AnimalID =</span> <span class="fu">gsub</span>(<span class="at">x =</span> AnimalID, <span class="at">pattern =</span> <span class="st">&#39;&quot;&#39;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-30"><a href="db-structure.html#cb3-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-31"><a href="db-structure.html#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SELECT COLUMNS</span></span>
<span id="cb3-32"><a href="db-structure.html#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename columns to more useful format, sort into better order</span></span>
<span id="cb3-33"><a href="db-structure.html#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Sorting columns...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="co"># print so user knows what step</span></span>
<span id="cb3-34"><a href="db-structure.html#cb3-34" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb3-35"><a href="db-structure.html#cb3-35" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb3-36"><a href="db-structure.html#cb3-36" aria-hidden="true" tabindex="-1"></a>            OBJECTID, </span>
<span id="cb3-37"><a href="db-structure.html#cb3-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">animal_id =</span> AnimalID,</span>
<span id="cb3-38"><a href="db-structure.html#cb3-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">species =</span> Species,</span>
<span id="cb3-39"><a href="db-structure.html#cb3-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">sex =</span> Sex,</span>
<span id="cb3-40"><a href="db-structure.html#cb3-40" aria-hidden="true" tabindex="-1"></a>            datetime,</span>
<span id="cb3-41"><a href="db-structure.html#cb3-41" aria-hidden="true" tabindex="-1"></a>            <span class="co"># added y and x so I can remember which one is which</span></span>
<span id="cb3-42"><a href="db-structure.html#cb3-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">lat_y =</span> Latitude,</span>
<span id="cb3-43"><a href="db-structure.html#cb3-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">lon_x =</span> Longitude,</span>
<span id="cb3-44"><a href="db-structure.html#cb3-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">cohort =</span> CurrentCohort,</span>
<span id="cb3-45"><a href="db-structure.html#cb3-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">birth_year =</span> BirthYear,</span>
<span id="cb3-46"><a href="db-structure.html#cb3-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">mortality =</span> mort,</span>
<span id="cb3-47"><a href="db-structure.html#cb3-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">capture_unit =</span> CaptureUnit,</span>
<span id="cb3-48"><a href="db-structure.html#cb3-48" aria-hidden="true" tabindex="-1"></a>            collar_id,</span>
<span id="cb3-49"><a href="db-structure.html#cb3-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">freq =</span> Freq,</span>
<span id="cb3-50"><a href="db-structure.html#cb3-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_stats =</span> NumSats,</span>
<span id="cb3-51"><a href="db-structure.html#cb3-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">dop =</span> Dop,</span>
<span id="cb3-52"><a href="db-structure.html#cb3-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">dim =</span> Dimension,</span>
<span id="cb3-53"><a href="db-structure.html#cb3-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">proj =</span> ProjectName)</span>
<span id="cb3-54"><a href="db-structure.html#cb3-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-55"><a href="db-structure.html#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Done&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-56"><a href="db-structure.html#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb3-57"><a href="db-structure.html#cb3-57" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>So now all I need to do is load my raw data and immediately pipe it into this formatting function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="db-structure.html#cb4-1" aria-hidden="true" tabindex="-1"></a>all_dat <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Data/GPS/all_data.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="db-structure.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="db-structure.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">base_format</span>()</span></code></pre></div>
</div>
<div id="sort-into-different-datasets" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Sort into Different Datasets</h3>
<p>Now I can begin to sort into the different datasets for my final database structure
<br></p>
<div id="individuals-dataset" class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Individuals Dataset</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="db-structure.html#cb5-1" aria-hidden="true" tabindex="-1"></a>indiv <span class="ot">&lt;-</span> all_dat <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="db-structure.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(animal_id, </span>
<span id="cb5-3"><a href="db-structure.html#cb5-3" aria-hidden="true" tabindex="-1"></a>           species, </span>
<span id="cb5-4"><a href="db-structure.html#cb5-4" aria-hidden="true" tabindex="-1"></a>           sex, </span>
<span id="cb5-5"><a href="db-structure.html#cb5-5" aria-hidden="true" tabindex="-1"></a>           cohort, </span>
<span id="cb5-6"><a href="db-structure.html#cb5-6" aria-hidden="true" tabindex="-1"></a>           birth_year, </span>
<span id="cb5-7"><a href="db-structure.html#cb5-7" aria-hidden="true" tabindex="-1"></a>           capture_unit)</span></code></pre></div>
<p>This table now shows the individual animals and their sex, species, birth year, and the management unit where they were captured.</p>
</div>
<div id="collar-deployment-dataset" class="section level4" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Collar Deployment Dataset</h4>
<p>This table will show the animals with their collars. Because some collars were used on more than one individual or an individual had more than one collar, I need to add a start and end date of when these animals had their specific collars.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="db-structure.html#cb6-1" aria-hidden="true" tabindex="-1"></a>collar_deploy <span class="ot">&lt;-</span> all_dat <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="db-structure.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id, collar_id) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="db-structure.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">min</span>(datetime),</span>
<span id="cb6-4"><a href="db-structure.html#cb6-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">end =</span> <span class="fu">max</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="db-structure.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(animal_id, collar_id, start, end)</span>
<span id="cb6-6"><a href="db-structure.html#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="db-structure.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create deployment ID</span></span>
<span id="cb6-8"><a href="db-structure.html#cb6-8" aria-hidden="true" tabindex="-1"></a>deploy_id <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(collar_deploy))</span>
<span id="cb6-9"><a href="db-structure.html#cb6-9" aria-hidden="true" tabindex="-1"></a>collar_deploy <span class="ot">&lt;-</span> <span class="fu">cbind</span>(deploy_id, collar_deploy)</span></code></pre></div>
</div>
<div id="location-dataset" class="section level4" number="3.2.2.3">
<h4><span class="header-section-number">3.2.2.3</span> Location Dataset</h4>
<p>For the Location datset, I also need to add a column for UTM x and UTM y. My study area is in Utah, which is UTM Zone 12N. To convert to UTM, I need to use the package <code>sf</code>. I also want to make sure I don’t have any datapoints outside of Utah, so I need the package <code>maps</code> to generate a <code>sf</code> object of Utah.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="db-structure.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb7-2"><a href="db-structure.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;maps&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="db-structure.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-2"><a href="db-structure.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span></code></pre></div>
<p>To make the conversion and clipping easier, I’ll create a function to convert given latitude and longitude coordinates to UTM and to check if these coordinates are within Utah.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="db-structure.html#cb9-1" aria-hidden="true" tabindex="-1"></a>convert_utm <span class="ot">&lt;-</span> <span class="cf">function</span>(latlon_df){</span>
<span id="cb9-2"><a href="db-structure.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  utm_df <span class="ot">&lt;-</span> latlon_df <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="db-structure.html#cb9-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(loc_id, lat_y, lon_x) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="db-structure.html#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># turns df into sf object with geometry</span></span>
<span id="cb9-5"><a href="db-structure.html#cb9-5" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon_x&quot;</span>, <span class="st">&quot;lat_y&quot;</span>),</span>
<span id="cb9-6"><a href="db-structure.html#cb9-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> <span class="co"># WGS84 = EPSG 4326</span></span>
<span id="cb9-7"><a href="db-structure.html#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># converts geometry to UTM 12N projection </span></span>
<span id="cb9-8"><a href="db-structure.html#cb9-8" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">32612</span>) <span class="sc">%&gt;%</span> <span class="co"># UTM 12N = EPSG 32612</span></span>
<span id="cb9-9"><a href="db-structure.html#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creates a new column of x and y UTM 12N coordinates</span></span>
<span id="cb9-10"><a href="db-structure.html#cb9-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">utm_x =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[, <span class="dv">1</span>],</span>
<span id="cb9-11"><a href="db-structure.html#cb9-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">utm_y =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[, <span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="db-structure.html#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drops geometry column</span></span>
<span id="cb9-13"><a href="db-structure.html#cb9-13" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb9-14"><a href="db-structure.html#cb9-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="db-structure.html#cb9-15" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> latlon_df <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="db-structure.html#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(utm_df, <span class="at">by =</span> <span class="st">&quot;loc_id&quot;</span>)</span>
<span id="cb9-17"><a href="db-structure.html#cb9-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-18"><a href="db-structure.html#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb9-19"><a href="db-structure.html#cb9-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="db-structure.html#cb10-1" aria-hidden="true" tabindex="-1"></a>clip_to_ut <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb10-2"><a href="db-structure.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  df_sf <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="db-structure.html#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transforms into sf object (WGS84 = EPSG 4326 )</span></span>
<span id="cb10-4"><a href="db-structure.html#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon_x&quot;</span>, <span class="st">&quot;lat_y&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="db-structure.html#cb10-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(loc_id, geometry)</span>
<span id="cb10-6"><a href="db-structure.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="db-structure.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load obj of usa from package &quot;maps&quot;</span></span>
<span id="cb10-8"><a href="db-structure.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  usa <span class="ot">&lt;-</span> maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">&quot;state&quot;</span>, <span class="at">plot =</span> F, <span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="db-structure.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># turn into sf obj</span></span>
<span id="cb10-10"><a href="db-structure.html#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>()</span>
<span id="cb10-11"><a href="db-structure.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  utah <span class="ot">&lt;-</span> usa <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="db-structure.html#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># finds the centroid</span></span>
<span id="cb10-13"><a href="db-structure.html#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="db-structure.html#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pulls out the coordinates</span></span>
<span id="cb10-15"><a href="db-structure.html#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="db-structure.html#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># binds x and y coordinates so they can be their own column in &quot;usa&quot;</span></span>
<span id="cb10-17"><a href="db-structure.html#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(usa) <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="db-structure.html#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pull out utah </span></span>
<span id="cb10-19"><a href="db-structure.html#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">&quot;utah&quot;</span>)</span>
<span id="cb10-20"><a href="db-structure.html#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="db-structure.html#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># makes a new column called &quot;indicator&quot; which makes TRUE or FALSE if the point</span></span>
<span id="cb10-22"><a href="db-structure.html#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   falls within Utah</span></span>
<span id="cb10-23"><a href="db-structure.html#cb10-23" aria-hidden="true" tabindex="-1"></a>  df_sf<span class="sc">$</span>indicator <span class="ot">&lt;-</span> <span class="fu">st_within</span>(df_sf, utah) <span class="sc">%&gt;%</span> </span>
<span id="cb10-24"><a href="db-structure.html#cb10-24" aria-hidden="true" tabindex="-1"></a>    lengths <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb10-25"><a href="db-structure.html#cb10-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-26"><a href="db-structure.html#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join with original dataframe</span></span>
<span id="cb10-27"><a href="db-structure.html#cb10-27" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df, df_sf, <span class="at">by =</span> <span class="st">&quot;loc_id&quot;</span>)</span>
<span id="cb10-28"><a href="db-structure.html#cb10-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-29"><a href="db-structure.html#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull out just the rows that are indicated as TRUE, meaning they are inside</span></span>
<span id="cb10-30"><a href="db-structure.html#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Utah</span></span>
<span id="cb10-31"><a href="db-structure.html#cb10-31" aria-hidden="true" tabindex="-1"></a>  df_clip <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-32"><a href="db-structure.html#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(df<span class="sc">$</span>indicator <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-33"><a href="db-structure.html#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drop indicator and geometry columns</span></span>
<span id="cb10-34"><a href="db-structure.html#cb10-34" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>indicator) <span class="sc">%&gt;%</span></span>
<span id="cb10-35"><a href="db-structure.html#cb10-35" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>geometry)</span>
<span id="cb10-36"><a href="db-structure.html#cb10-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-37"><a href="db-structure.html#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_clip)</span>
<span id="cb10-38"><a href="db-structure.html#cb10-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now I just need to pipe the data through these functions.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="db-structure.html#cb11-1" aria-hidden="true" tabindex="-1"></a>loc <span class="ot">&lt;-</span> all_dat <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="db-structure.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loc_id =</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(all_dat))) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="db-structure.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(loc_id, animal_id, datetime, lat_y, lon_x) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="db-structure.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convert_utm</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="db-structure.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clip_to_ut</span>()</span></code></pre></div>
</div>
</div>
</div>
<div id="rsqlite" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> RSQLite</h2>
<p>Now that I’ve formatted all my datasets, it’s time to put them together in a database.</p>
<p>To form this database, I will be working in with the package <code>RSQLite</code></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="db-structure.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Packages----</span></span>
<span id="cb12-2"><a href="db-structure.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;RSQLite&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="db-structure.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Packages----</span></span>
<span id="cb13-2"><a href="db-structure.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span></code></pre></div>
<p>Once the package is installed and loaded, I can begin working in RSQLite. First, I need to create the database.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="db-structure.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Establish Database Connection</span></span>
<span id="cb14-2"><a href="db-structure.html#cb14-2" aria-hidden="true" tabindex="-1"></a>db <span class="ot">=</span> <span class="fu">dbConnect</span>(<span class="at">drv =</span> RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">&quot;Data/barrier_proj.db&quot;</span>)</span></code></pre></div>
<p>Then, I need to create the tables for all of my datasets. I need to create the <code>individuals</code> table first because it has no foreign key but its primary key (<code>animal_id</code>) is a foreign key for the other tables.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="db-structure.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(db, </span>
<span id="cb15-2"><a href="db-structure.html#cb15-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;CREATE TABLE individuals(</span></span>
<span id="cb15-3"><a href="db-structure.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="st">          animal_id char(9) NOT NULL PRIMARY KEY,</span></span>
<span id="cb15-4"><a href="db-structure.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st">          species char(8), </span></span>
<span id="cb15-5"><a href="db-structure.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st">          sex char(1) CHECK (sex IN (&#39;M&#39;, &#39;F&#39;, &#39;U&#39;)),</span></span>
<span id="cb15-6"><a href="db-structure.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st">          cohort varchar(10),</span></span>
<span id="cb15-7"><a href="db-structure.html#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">          birth_year integer,</span></span>
<span id="cb15-8"><a href="db-structure.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="st">          capture_unit varchar(20)</span></span>
<span id="cb15-9"><a href="db-structure.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">          );&quot;</span>)</span></code></pre></div>
<p>I made <code>animal_id</code> of class <code>char</code> instead of <code>varchar</code> because every ID follows the same format: SPYYSXXXX</p>
<ul>
<li>SP = species abbreviation (MD or PR)</li>
<li>YY = year captured</li>
<li>S = sex</li>
<li>XXXX = incremental unit</li>
</ul>
<p>For example, the 10th female mule deer captured in 2017 would have an id MD17F0010</p>
<p>Fortunately, both “pronghorn” and “mule deer” have the same number of characters (8), so I can make <code>species</code> a <code>char</code> class instead of <code>varchar</code>.</p>
<p>Let’s check that the table was built ok. Since I didn’t put any data yet, it should be empty.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="db-structure.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(<span class="at">conn =</span> db, <span class="at">statement =</span> <span class="st">&quot;SELECT * FROM individuals;&quot;</span>)</span></code></pre></div>
<p>Awesome! Now I can create the other tables that use <code>animal_id</code> as a foreign key.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="db-structure.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(db, </span>
<span id="cb17-2"><a href="db-structure.html#cb17-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;CREATE TABLE collar_deploy(</span></span>
<span id="cb17-3"><a href="db-structure.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="st">          deploy_id integer NOT NULL PRIMARY KEY,</span></span>
<span id="cb17-4"><a href="db-structure.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="st">          collar_id integer,</span></span>
<span id="cb17-5"><a href="db-structure.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="st">          animal_id char(9), </span></span>
<span id="cb17-6"><a href="db-structure.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="st">          start text,</span></span>
<span id="cb17-7"><a href="db-structure.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">          end text,</span></span>
<span id="cb17-8"><a href="db-structure.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">          FOREIGN KEY (animal_id) REFERENCES individuals(animal_id)</span></span>
<span id="cb17-9"><a href="db-structure.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">          );&quot;</span>)</span>
<span id="cb17-10"><a href="db-structure.html#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="db-structure.html#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(db, </span>
<span id="cb17-12"><a href="db-structure.html#cb17-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;CREATE TABLE location(</span></span>
<span id="cb17-13"><a href="db-structure.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="st">          loc_id integer NOT NULL PRIMARY KEY,</span></span>
<span id="cb17-14"><a href="db-structure.html#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="st">          animal_id char(9),</span></span>
<span id="cb17-15"><a href="db-structure.html#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">          datetime text,</span></span>
<span id="cb17-16"><a href="db-structure.html#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="st">          lat_y double, </span></span>
<span id="cb17-17"><a href="db-structure.html#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="st">          lon_x double,</span></span>
<span id="cb17-18"><a href="db-structure.html#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="st">          utm_x double,</span></span>
<span id="cb17-19"><a href="db-structure.html#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="st">          utm_y double,</span></span>
<span id="cb17-20"><a href="db-structure.html#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="st">          FOREIGN KEY (animal_id) REFERENCES individuals(animal_id)</span></span>
<span id="cb17-21"><a href="db-structure.html#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="st">          );&quot;</span>)</span></code></pre></div>
<p>After the tables are created, all I need to do is import the data into the database.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="db-structure.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(db, <span class="st">&quot;individuals&quot;</span>, indiv, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="db-structure.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="db-structure.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(db, <span class="st">&quot;collar_deploy&quot;</span>, collar, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-4"><a href="db-structure.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="db-structure.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(db, <span class="st">&quot;location&quot;</span>, loc, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-6"><a href="db-structure.html#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="db-structure.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;!--</span>chapter<span class="sc">:</span>end<span class="sc">:</span><span class="dv">02</span><span class="sc">-</span>structure.Rmd<span class="sc">-</span><span class="ot">-&gt;</span></span>
<span id="cb18-8"><a href="db-structure.html#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="db-structure.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Home Range Visualization {#hr_viz}</span></span>
<span id="cb18-10"><a href="db-structure.html#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="db-structure.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="do">## LoCoH Home Ranges</span></span>
<span id="cb18-12"><a href="db-structure.html#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="db-structure.html#cb18-13" aria-hidden="true" tabindex="-1"></a>A home range is defined as <span class="st">&quot;the area an animal normally travels&quot;</span> (Burt, <span class="dv">1943</span>), or a spatially bounded pattern of an individual<span class="st">&#39;s space-use process. A home range is not necessarily the same inter- or intra-annually -- this is especially true for migrants or partial-migrants. Because a home range is dependent on temporal scales, I will need to delineate home ranges of a specific season within a specifc year, as this home range is likely to change by the next season or year. To estimate home ranges, I need to generate a utilization distribution (UD) -- the probability density distribution of animal occurrence in a two-dimensional space -- which is bounded by a specific contour aka isopleth.</span></span>
<span id="cb18-14"><a href="db-structure.html#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="db-structure.html#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="st">### Research Questions</span></span>
<span id="cb18-16"><a href="db-structure.html#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="db-structure.html#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="st">* How does an animal&#39;</span>s home range shape change with the presence of linear <span class="fu">features</span> (roads or fences)?</span>
<span id="cb18-18"><a href="db-structure.html#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> How does an animal<span class="st">&#39;s home range area change with barrier density?</span></span>
<span id="cb18-19"><a href="db-structure.html#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="db-structure.html#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="st">LoCoH -- or Local Convex Hull -- differs from other home range UDs in that it shows gaps and sharp boundaries of the animal&#39;</span>s movement. This is useful <span class="cf">for</span> my research because I can see <span class="cf">if</span> the home range shape is affected by linear features <span class="sc">--</span> such as <span class="cf">if</span> it runs parallel to a barrier.</span>
<span id="cb18-21"><a href="db-structure.html#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="db-structure.html#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="db-structure.html#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="db-structure.html#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="do">### Objectives</span></span>
<span id="cb18-25"><a href="db-structure.html#cb18-25" aria-hidden="true" tabindex="-1"></a>My objective <span class="cf">for</span> this code is to delineate and plot the LoCoH home range <span class="cf">for</span> every season of every year <span class="cf">for</span> every individual. I also want to plot a boxplot of the estimated areas of that year<span class="st">&#39;s home ranges.</span></span>
<span id="cb18-26"><a href="db-structure.html#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="db-structure.html#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="st">## Set Up</span></span>
<span id="cb18-28"><a href="db-structure.html#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="db-structure.html#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="st">For this task, I&#39;</span>ll be using a lot of packages. I<span class="st">&#39;ll use `dplyr` to pipe and organize the dataframes, but since I&#39;</span>ll also use <span class="st">`</span><span class="at">ggplot2</span><span class="st">`</span>, I will just go ahead and use the whole <span class="st">`</span><span class="at">tidyverse</span><span class="st">`</span> package. I<span class="st">&#39;ll also use `lubridate` to help deal with year formatting. To deal with simple features and spatial data, I&#39;</span>ll use the packages <span class="st">`</span><span class="at">sf</span><span class="st">`</span> and <span class="st">`</span><span class="at">sp</span><span class="st">`</span>. To help make my plots look nice, I<span class="st">&#39;ll use the packages `patchwork` and `viridis`. And, finally, to deal with steps and home ranges, I&#39;</span>ll use the package <span class="st">`</span><span class="at">amt</span><span class="st">`</span>.</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="db-structure.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb19-2"><a href="db-structure.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span>
<span id="cb19-3"><a href="db-structure.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;amt&quot;</span>)</span>
<span id="cb19-4"><a href="db-structure.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sp&quot;</span>)</span>
<span id="cb19-5"><a href="db-structure.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb19-6"><a href="db-structure.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;patchwork&quot;</span>)</span>
<span id="cb19-7"><a href="db-structure.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;viridis&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="db-structure.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb20-2"><a href="db-structure.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb20-3"><a href="db-structure.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(amt)</span>
<span id="cb20-4"><a href="db-structure.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb20-5"><a href="db-structure.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb20-6"><a href="db-structure.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb20-7"><a href="db-structure.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="db-structure.html#cb21-1" aria-hidden="true" tabindex="-1"></a>in_dir <span class="ot">&lt;-</span> <span class="st">&quot;Data/GPS/Processed/Individuals/&quot;</span></span>
<span id="cb21-2"><a href="db-structure.html#cb21-2" aria-hidden="true" tabindex="-1"></a>out_dir <span class="ot">&lt;-</span> <span class="st">&quot;Analysis/Output/LoCoH/&quot;</span></span>
<span id="cb21-3"><a href="db-structure.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="db-structure.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the output directory exists or not</span></span>
<span id="cb21-5"><a href="db-structure.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir)) {</span>
<span id="cb21-6"><a href="db-structure.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(out_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-7"><a href="db-structure.html#cb21-7" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="db-structure.html#cb22-1" aria-hidden="true" tabindex="-1"></a>ani_fn <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> in_dir, <span class="at">full.names =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="db-structure.html#cb23-1" aria-hidden="true" tabindex="-1"></a>iso_levels <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb23-2"><a href="db-structure.html#cb23-2" aria-hidden="true" tabindex="-1"></a>locoh_type <span class="ot">&lt;-</span> <span class="st">&quot;a&quot;</span></span></code></pre></div>
<p>Based on previous research on migratory or partially migratory pronghorn and mule deer in Utah, I can be reasonably certain of the times when these animals would be in their summer and winter ranges and when they would be in their spring and autumn migrations.</p>
<table>
<thead>
<tr class="header">
<th>Season</th>
<th>Dates</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Summer</td>
<td>July 1 - September 30</td>
</tr>
<tr class="even">
<td>Winter</td>
<td>January 1 - March 31</td>
</tr>
<tr class="odd">
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Spring</td>
<td>April 1 - June 30</td>
</tr>
<tr class="odd">
<td>Autumn</td>
<td>October 1 - December 31</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="db-structure.html#cb24-1" aria-hidden="true" tabindex="-1"></a>winter <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb24-2"><a href="db-structure.html#cb24-2" aria-hidden="true" tabindex="-1"></a>spring <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb24-3"><a href="db-structure.html#cb24-3" aria-hidden="true" tabindex="-1"></a>summer <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb24-4"><a href="db-structure.html#cb24-4" aria-hidden="true" tabindex="-1"></a>autumn <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>)</span></code></pre></div>
</div>
<div id="locoh-home-range-for-one-season" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> LoCoH Home Range for One Season</h2>
<div id="delineate-seasonal-locoh-hull" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Delineate Seasonal LoCoH Hull</h3>
<p>First I need to read in the rds data into a data frame. I only need the animal ID, the date and time stamp, and utm x and y positions. To be safe, I’m also going to sort the datetime column. Then, for ease, I’ll add a column of the year and the season of that position.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="db-structure.html#cb25-1" aria-hidden="true" tabindex="-1"></a>animal_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(ani_fn) <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="db-structure.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(animal_id, datetime, utm_x, utm_y) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="db-structure.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="db-structure.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort by earliest to latest datetime</span></span>
<span id="cb25-5"><a href="db-structure.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(datetime) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="db-structure.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a column for year and season</span></span>
<span id="cb25-7"><a href="db-structure.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-8"><a href="db-structure.html#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">yr =</span> <span class="fu">year</span>(datetime),</span>
<span id="cb25-9"><a href="db-structure.html#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ssn =</span> <span class="fu">case_when</span>(<span class="fu">month</span>(datetime) <span class="sc">%in%</span> winter <span class="sc">~</span> <span class="st">&quot;Winter&quot;</span>,</span>
<span id="cb25-10"><a href="db-structure.html#cb25-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">month</span>(datetime) <span class="sc">%in%</span> spring <span class="sc">~</span> <span class="st">&quot;Spring&quot;</span>,</span>
<span id="cb25-11"><a href="db-structure.html#cb25-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">month</span>(datetime) <span class="sc">%in%</span> summer <span class="sc">~</span> <span class="st">&quot;Summer&quot;</span>,</span>
<span id="cb25-12"><a href="db-structure.html#cb25-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">month</span>(datetime) <span class="sc">%in%</span> autumn <span class="sc">~</span> <span class="st">&quot;Autumn&quot;</span>))</span></code></pre></div>
<p>Let’s see how many years this individual was tracked</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="db-structure.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(animal_df<span class="sc">$</span>yr))</span></code></pre></div>
<pre><code>## [1] 2013 2014</code></pre>
<p>Let’s just work with 2013 data for now, so let’s filter the <code>animal_df</code> dataframe.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="db-structure.html#cb28-1" aria-hidden="true" tabindex="-1"></a>ani_yr <span class="ot">&lt;-</span> animal_df <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="db-structure.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yr <span class="sc">==</span> <span class="dv">2013</span>)</span></code></pre></div>
<p>Let’s see how many seasons this individual was tracked in 2013</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="db-structure.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(ani_yr<span class="sc">$</span>ssn))</span></code></pre></div>
<pre><code>## [1] &quot;Winter&quot; &quot;Spring&quot; &quot;Summer&quot; &quot;Autumn&quot;</code></pre>
<p>Let’s just work with Winter data for now, so let’s filter the <code>ani_yr</code> dataframe.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="db-structure.html#cb31-1" aria-hidden="true" tabindex="-1"></a>ani_ssn <span class="ot">&lt;-</span> ani_yr <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="db-structure.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ssn <span class="sc">==</span> <span class="st">&quot;Winter&quot;</span>)</span></code></pre></div>
<p>Now that I have a dataframe of just one season in one year for one individual, I can delineate this season’s LoCoH hull. I’ll use the <code>make_track</code> function from the <code>amt</code> package to make a track of all the individual’s steps of this season, and then the function <code>hr_locoh</code> to delineate the LoCoH hulls with the isopleth levels I specified earlier.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="db-structure.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make the track</span></span>
<span id="cb32-2"><a href="db-structure.html#cb32-2" aria-hidden="true" tabindex="-1"></a>track <span class="ot">&lt;-</span> ani_ssn <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="db-structure.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_track</span>(utm_x, utm_y, datetime, animal_id, </span>
<span id="cb32-4"><a href="db-structure.html#cb32-4" aria-hidden="true" tabindex="-1"></a>             <span class="co"># EPSG:32612 = WGS 84 / UTM zone 12N</span></span>
<span id="cb32-5"><a href="db-structure.html#cb32-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">crs =</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:32612&quot;</span>))  </span>
<span id="cb32-6"><a href="db-structure.html#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="db-structure.html#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the max distance between points for parameter &quot;n&quot;</span></span>
<span id="cb32-8"><a href="db-structure.html#cb32-8" aria-hidden="true" tabindex="-1"></a>max_dist <span class="ot">&lt;-</span> track[, <span class="fu">c</span>(<span class="st">&quot;x_&quot;</span>, <span class="st">&quot;y_&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="db-structure.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-10"><a href="db-structure.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>()</span>
<span id="cb32-11"><a href="db-structure.html#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="db-structure.html#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># delineate the locoh home range for the given season</span></span>
<span id="cb32-13"><a href="db-structure.html#cb32-13" aria-hidden="true" tabindex="-1"></a>locoh_ssn <span class="ot">&lt;-</span> track <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="db-structure.html#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hr_locoh</span>(<span class="at">levels =</span> iso_levels,</span>
<span id="cb32-15"><a href="db-structure.html#cb32-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">keep.data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-16"><a href="db-structure.html#cb32-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> max_dist,</span>
<span id="cb32-17"><a href="db-structure.html#cb32-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> locoh_type,</span>
<span id="cb32-18"><a href="db-structure.html#cb32-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">rand_buffer =</span> <span class="fl">1e-05</span>)</span></code></pre></div>
</div>
<div id="plot-home-range" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Plot Home Range</h3>
<p>Now that I have the LoCoH hull of this season, I can plot it and save the plot and data.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="db-structure.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(locoh_ssn)</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_01-1.png" width="672" /></p>
<p>Let’s try in ggplot. First I have to turn <code>locoh_ssn</code> into an <code>sf</code> object using the function <code>hr_isopleths</code> in <code>amt</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="db-structure.html#cb34-1" aria-hidden="true" tabindex="-1"></a>locoh_ssn <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="db-structure.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hr_isopleths</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="db-structure.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-4"><a href="db-structure.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_02-1.png" width="672" /></p>
<p>But right now, the isopleth levels are from small to large, so the largest isopleth are stacked on top and I can’t see the smaller ones. So first I have to re-arrange the levels.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="db-structure.html#cb35-1" aria-hidden="true" tabindex="-1"></a>locoh_ssn <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="db-structure.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hr_isopleths</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="db-structure.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(level)) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="db-structure.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-5"><a href="db-structure.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_03-1.png" width="672" /></p>
<p>Great! But I can’t tell which isopleth is which</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="db-structure.html#cb36-1" aria-hidden="true" tabindex="-1"></a>locoh_ssn <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="db-structure.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hr_isopleths</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="db-structure.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(level)) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="db-structure.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb36-5"><a href="db-structure.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level))</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_04-1.png" width="672" /></p>
<p>The darker colors are of the smaller isopleths, showing the areas where the animal spent the majority of their time in this season.</p>
<p>This plot is fine, but let’s pretty it up a little. I’m going to remove the outlines of the isopleths, change the theme, add labels for the axes, legend, and title, and change the color scheme to viridis.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="db-structure.html#cb37-1" aria-hidden="true" tabindex="-1"></a>ani_name <span class="ot">&lt;-</span> <span class="fu">unique</span>(animal_df<span class="sc">$</span>animal_id)</span>
<span id="cb37-2"><a href="db-structure.html#cb37-2" aria-hidden="true" tabindex="-1"></a>locoh_ssn <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="db-structure.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hr_isopleths</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="db-structure.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(level)) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="db-structure.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-6"><a href="db-structure.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="db-structure.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-8"><a href="db-structure.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb37-9"><a href="db-structure.html#cb37-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">paste</span>(ani_name, <span class="st">&quot;LoCoH Winter 2013&quot;</span>),</span>
<span id="cb37-10"><a href="db-structure.html#cb37-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Isopleth&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-11"><a href="db-structure.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>),</span>
<span id="cb37-12"><a href="db-structure.html#cb37-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">option =</span> <span class="st">&quot;inferno&quot;</span>)</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_05-1.png" width="672" /></p>
<p>I can also add the animal’s original position points</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="db-structure.html#cb38-1" aria-hidden="true" tabindex="-1"></a>locoh_ssn <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="db-structure.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hr_isopleths</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="db-structure.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(level)) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="db-structure.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-5"><a href="db-structure.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb38-6"><a href="db-structure.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-7"><a href="db-structure.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb38-8"><a href="db-structure.html#cb38-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">paste</span>(ani_name, <span class="st">&quot;LoCoH Winter 2013&quot;</span>),</span>
<span id="cb38-9"><a href="db-structure.html#cb38-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Isopleth&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="db-structure.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>),</span>
<span id="cb38-11"><a href="db-structure.html#cb38-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">option =</span> <span class="st">&quot;inferno&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-12"><a href="db-structure.html#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> locoh_ssn<span class="sc">$</span>data,</span>
<span id="cb38-13"><a href="db-structure.html#cb38-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_, <span class="at">y =</span> y_),</span>
<span id="cb38-14"><a href="db-structure.html#cb38-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_06-1.png" width="672" /></p>
<p>Looks great! Let’s save this plot in an output figure’s folder.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="db-structure.html#cb39-1" aria-hidden="true" tabindex="-1"></a>plot_fn <span class="ot">&lt;-</span> <span class="fu">paste0</span>(ani_name, <span class="st">&quot;2013_winter.tiff&quot;</span>)</span>
<span id="cb39-2"><a href="db-structure.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(plot_fn, <span class="at">path =</span> out_dir)</span></code></pre></div>
</div>
</div>
<div id="locoh-home-range-for-all-seasons-in-all-years" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> LoCoH Home Range for all seasons in all years</h2>
<p>However, it’s not very useful to copy and paste this code for every season of every year for this individual, and becomes even more tedious when I introduce this for more than one individual. In my real data, I have 3901 individuals, so it would make more sense to loop over all of these functions using <code>lapply</code>.</p>
<p>Here’s all of the functions I went through above but now in nested loops</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="db-structure.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load and format individual&#39;s data frame</span></span>
<span id="cb40-2"><a href="db-structure.html#cb40-2" aria-hidden="true" tabindex="-1"></a>animal_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(ani_fn) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="db-structure.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(animal_id, datetime, utm_x, utm_y) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="db-structure.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="db-structure.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(datetime) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="db-structure.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-7"><a href="db-structure.html#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">yr =</span> <span class="fu">year</span>(datetime),</span>
<span id="cb40-8"><a href="db-structure.html#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ssn =</span> <span class="fu">case_when</span>(<span class="fu">month</span>(datetime) <span class="sc">%in%</span> winter <span class="sc">~</span> <span class="st">&quot;Winter&quot;</span>,</span>
<span id="cb40-9"><a href="db-structure.html#cb40-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">month</span>(datetime) <span class="sc">%in%</span> spring <span class="sc">~</span> <span class="st">&quot;Spring&quot;</span>,</span>
<span id="cb40-10"><a href="db-structure.html#cb40-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">month</span>(datetime) <span class="sc">%in%</span> summer <span class="sc">~</span> <span class="st">&quot;Summer&quot;</span>,</span>
<span id="cb40-11"><a href="db-structure.html#cb40-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">month</span>(datetime) <span class="sc">%in%</span> autumn <span class="sc">~</span> <span class="st">&quot;Autumn&quot;</span>))</span>
<span id="cb40-12"><a href="db-structure.html#cb40-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-13"><a href="db-structure.html#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># make a vector for the unique years</span></span>
<span id="cb40-14"><a href="db-structure.html#cb40-14" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(animal_df<span class="sc">$</span>yr)</span>
<span id="cb40-15"><a href="db-structure.html#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="db-structure.html#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through every year for this individual</span></span>
<span id="cb40-17"><a href="db-structure.html#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># (returns a list of locoh for all years with all seasons of those years)</span></span>
<span id="cb40-18"><a href="db-structure.html#cb40-18" aria-hidden="true" tabindex="-1"></a>locoh <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years), <span class="cf">function</span>(y){</span>
<span id="cb40-19"><a href="db-structure.html#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter by year</span></span>
<span id="cb40-20"><a href="db-structure.html#cb40-20" aria-hidden="true" tabindex="-1"></a>  ani_yr <span class="ot">&lt;-</span> animal_df <span class="sc">%&gt;%</span></span>
<span id="cb40-21"><a href="db-structure.html#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(yr <span class="sc">==</span> years[y])</span>
<span id="cb40-22"><a href="db-structure.html#cb40-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-23"><a href="db-structure.html#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a vector for the unique seasons of that year</span></span>
<span id="cb40-24"><a href="db-structure.html#cb40-24" aria-hidden="true" tabindex="-1"></a>  seasons <span class="ot">&lt;-</span> <span class="fu">unique</span>(ani_yr<span class="sc">$</span>ssn)</span>
<span id="cb40-25"><a href="db-structure.html#cb40-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-26"><a href="db-structure.html#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop through every seasons for that year</span></span>
<span id="cb40-27"><a href="db-structure.html#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (returns a list of locoh for all the seasons of that year)</span></span>
<span id="cb40-28"><a href="db-structure.html#cb40-28" aria-hidden="true" tabindex="-1"></a>  locoh_yr <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(seasons), <span class="cf">function</span>(s){</span>
<span id="cb40-29"><a href="db-structure.html#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter by season</span></span>
<span id="cb40-30"><a href="db-structure.html#cb40-30" aria-hidden="true" tabindex="-1"></a>    ani_ssn <span class="ot">&lt;-</span> ani_yr <span class="sc">%&gt;%</span></span>
<span id="cb40-31"><a href="db-structure.html#cb40-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(ssn <span class="sc">==</span> seasons[s])</span>
<span id="cb40-32"><a href="db-structure.html#cb40-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-33"><a href="db-structure.html#cb40-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># delineate the locoh home range for the given season</span></span>
<span id="cb40-34"><a href="db-structure.html#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make the track</span></span>
<span id="cb40-35"><a href="db-structure.html#cb40-35" aria-hidden="true" tabindex="-1"></a>    track <span class="ot">&lt;-</span> ani_ssn <span class="sc">%&gt;%</span></span>
<span id="cb40-36"><a href="db-structure.html#cb40-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">make_track</span>(utm_x, utm_y, datetime, animal_id, </span>
<span id="cb40-37"><a href="db-structure.html#cb40-37" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># EPSG:32612 = WGS 84 / UTM zone 12N</span></span>
<span id="cb40-38"><a href="db-structure.html#cb40-38" aria-hidden="true" tabindex="-1"></a>                 <span class="at">crs =</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:32612&quot;</span>)) </span>
<span id="cb40-39"><a href="db-structure.html#cb40-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-40"><a href="db-structure.html#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the max distance between points for parameter &quot;n&quot;</span></span>
<span id="cb40-41"><a href="db-structure.html#cb40-41" aria-hidden="true" tabindex="-1"></a>    max_dist <span class="ot">&lt;-</span> track[, <span class="fu">c</span>(<span class="st">&quot;x_&quot;</span>, <span class="st">&quot;y_&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb40-42"><a href="db-structure.html#cb40-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-43"><a href="db-structure.html#cb40-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>()</span>
<span id="cb40-44"><a href="db-structure.html#cb40-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-45"><a href="db-structure.html#cb40-45" aria-hidden="true" tabindex="-1"></a>    locoh_ssn <span class="ot">&lt;-</span> track <span class="sc">%&gt;%</span></span>
<span id="cb40-46"><a href="db-structure.html#cb40-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hr_locoh</span>(<span class="at">levels =</span> iso_levels,</span>
<span id="cb40-47"><a href="db-structure.html#cb40-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">keep.data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-48"><a href="db-structure.html#cb40-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">n =</span> max_dist,</span>
<span id="cb40-49"><a href="db-structure.html#cb40-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> locoh_type,</span>
<span id="cb40-50"><a href="db-structure.html#cb40-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">rand_buffer =</span> <span class="fl">1e-05</span>)</span>
<span id="cb40-51"><a href="db-structure.html#cb40-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-52"><a href="db-structure.html#cb40-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(locoh_ssn)</span>
<span id="cb40-53"><a href="db-structure.html#cb40-53" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb40-54"><a href="db-structure.html#cb40-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># name the elements of this list after the seaons of that year</span></span>
<span id="cb40-55"><a href="db-structure.html#cb40-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(locoh_yr) <span class="ot">&lt;-</span> seasons</span>
<span id="cb40-56"><a href="db-structure.html#cb40-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(locoh_yr)</span>
<span id="cb40-57"><a href="db-structure.html#cb40-57" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-58"><a href="db-structure.html#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="co"># name the elements of this list after the years for this individual</span></span>
<span id="cb40-59"><a href="db-structure.html#cb40-59" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(locoh) <span class="ot">&lt;-</span> years</span></code></pre></div>
<p>Now, I have a large list of every LoCoH home range of this individual, named with its corresponding season and year. I can access this data by indexing, such as <code>locoh[[1]][[3]]</code> or using the names of each list, such as <code>locoh$2013$"Summer"</code>. Or I can use <code>lapply</code> again to get all seasons of all years into one dataframe.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="db-structure.html#cb41-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">names</span>(locoh)</span>
<span id="cb41-2"><a href="db-structure.html#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="db-structure.html#cb41-3" aria-hidden="true" tabindex="-1"></a>hr_sf <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(locoh), <span class="cf">function</span>(y){</span>
<span id="cb41-4"><a href="db-structure.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  hr_yr <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(locoh[[y]]), <span class="cf">function</span>(s){</span>
<span id="cb41-5"><a href="db-structure.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    seasons <span class="ot">&lt;-</span> <span class="fu">names</span>(locoh[[y]])</span>
<span id="cb41-6"><a href="db-structure.html#cb41-6" aria-hidden="true" tabindex="-1"></a>    hr <span class="ot">&lt;-</span> locoh[[y]][[s]] <span class="sc">%&gt;%</span></span>
<span id="cb41-7"><a href="db-structure.html#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hr_isopleths</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="db-structure.html#cb41-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(level)) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="db-structure.html#cb41-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb41-10"><a href="db-structure.html#cb41-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> years[y],</span>
<span id="cb41-11"><a href="db-structure.html#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">season =</span> seasons[s])</span>
<span id="cb41-12"><a href="db-structure.html#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(hr)</span>
<span id="cb41-13"><a href="db-structure.html#cb41-13" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb41-14"><a href="db-structure.html#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb41-15"><a href="db-structure.html#cb41-15" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> </span>
<span id="cb41-16"><a href="db-structure.html#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<p>I can use this to plot all the seasonal LoCoH hulls of a single year together.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="db-structure.html#cb42-1" aria-hidden="true" tabindex="-1"></a>winter_2013 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="db-structure.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span> <span class="sc">&amp;</span> season <span class="sc">==</span> <span class="st">&quot;Winter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="db-structure.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="db-structure.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb42-5"><a href="db-structure.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-6"><a href="db-structure.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb42-7"><a href="db-structure.html#cb42-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Winter 2013&quot;</span>,</span>
<span id="cb42-8"><a href="db-structure.html#cb42-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Isopleth&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-9"><a href="db-structure.html#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>))</span>
<span id="cb42-10"><a href="db-structure.html#cb42-10" aria-hidden="true" tabindex="-1"></a>summer_2013 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb42-11"><a href="db-structure.html#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span> <span class="sc">&amp;</span> season <span class="sc">==</span> <span class="st">&quot;Summer&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="db-structure.html#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb42-13"><a href="db-structure.html#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb42-14"><a href="db-structure.html#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-15"><a href="db-structure.html#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb42-16"><a href="db-structure.html#cb42-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Summer 2013&quot;</span>,</span>
<span id="cb42-17"><a href="db-structure.html#cb42-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Isopleth&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-18"><a href="db-structure.html#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>),</span>
<span id="cb42-19"><a href="db-structure.html#cb42-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">option =</span> <span class="st">&quot;inferno&quot;</span>)</span>
<span id="cb42-20"><a href="db-structure.html#cb42-20" aria-hidden="true" tabindex="-1"></a>spring_2013 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb42-21"><a href="db-structure.html#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span> <span class="sc">&amp;</span> season <span class="sc">==</span> <span class="st">&quot;Spring&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-22"><a href="db-structure.html#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb42-23"><a href="db-structure.html#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb42-24"><a href="db-structure.html#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-25"><a href="db-structure.html#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb42-26"><a href="db-structure.html#cb42-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Spring 2013&quot;</span>,</span>
<span id="cb42-27"><a href="db-structure.html#cb42-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Isopleth&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-28"><a href="db-structure.html#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>),</span>
<span id="cb42-29"><a href="db-structure.html#cb42-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>)</span>
<span id="cb42-30"><a href="db-structure.html#cb42-30" aria-hidden="true" tabindex="-1"></a>autumn_2013 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb42-31"><a href="db-structure.html#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span> <span class="sc">&amp;</span> season <span class="sc">==</span> <span class="st">&quot;Autumn&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-32"><a href="db-structure.html#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb42-33"><a href="db-structure.html#cb42-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb42-34"><a href="db-structure.html#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-35"><a href="db-structure.html#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb42-36"><a href="db-structure.html#cb42-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Autumn 2013&quot;</span>,</span>
<span id="cb42-37"><a href="db-structure.html#cb42-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Isopleth&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-38"><a href="db-structure.html#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>),</span>
<span id="cb42-39"><a href="db-structure.html#cb42-39" aria-hidden="true" tabindex="-1"></a>                        <span class="at">option =</span> <span class="st">&quot;magma&quot;</span>)</span>
<span id="cb42-40"><a href="db-structure.html#cb42-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-41"><a href="db-structure.html#cb42-41" aria-hidden="true" tabindex="-1"></a>(winter_2013 <span class="sc">|</span> summer_2013) <span class="sc">/</span>(spring_2013 <span class="sc">|</span> autumn_2013)</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_4x4-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="db-structure.html#cb43-1" aria-hidden="true" tabindex="-1"></a>winter_plot <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="db-structure.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">&quot;Winter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="db-structure.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="db-structure.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb43-5"><a href="db-structure.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="db-structure.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb43-7"><a href="db-structure.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb43-8"><a href="db-structure.html#cb43-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;MD13F0001 Winter LoCoH Hull&quot;</span>,</span>
<span id="cb43-9"><a href="db-structure.html#cb43-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>)</span>
<span id="cb43-10"><a href="db-structure.html#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="db-structure.html#cb43-11" aria-hidden="true" tabindex="-1"></a>summer_plot <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="db-structure.html#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">&quot;Summer&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-13"><a href="db-structure.html#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level, <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb43-14"><a href="db-structure.html#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb43-15"><a href="db-structure.html#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-16"><a href="db-structure.html#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb43-17"><a href="db-structure.html#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb43-18"><a href="db-structure.html#cb43-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;MD13F0001 Summer LoCoH Hull&quot;</span>,</span>
<span id="cb43-19"><a href="db-structure.html#cb43-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Isopleth&quot;</span>)</span>
<span id="cb43-20"><a href="db-structure.html#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="db-structure.html#cb43-21" aria-hidden="true" tabindex="-1"></a>winter_plot <span class="sc">|</span>  summer_plot</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_winter_summer-1.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="db-structure.html#cb44-1" aria-hidden="true" tabindex="-1"></a>season_2013 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="db-structure.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span> <span class="sc">&amp;</span></span>
<span id="cb44-3"><a href="db-structure.html#cb44-3" aria-hidden="true" tabindex="-1"></a>           season <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;Winter&quot;</span>, <span class="st">&quot;Summer&quot;</span>))</span>
<span id="cb44-4"><a href="db-structure.html#cb44-4" aria-hidden="true" tabindex="-1"></a>transition_2013 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="db-structure.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span> <span class="sc">&amp;</span></span>
<span id="cb44-6"><a href="db-structure.html#cb44-6" aria-hidden="true" tabindex="-1"></a>           season <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;Spring&quot;</span>, <span class="st">&quot;Autumn&quot;</span>))</span>
<span id="cb44-7"><a href="db-structure.html#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="db-structure.html#cb44-8" aria-hidden="true" tabindex="-1"></a>season_2014 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="db-structure.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span></span>
<span id="cb44-10"><a href="db-structure.html#cb44-10" aria-hidden="true" tabindex="-1"></a>           season <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;Winter&quot;</span>, <span class="st">&quot;Summer&quot;</span>))</span>
<span id="cb44-11"><a href="db-structure.html#cb44-11" aria-hidden="true" tabindex="-1"></a>transition_2014 <span class="ot">&lt;-</span> hr_sf <span class="sc">%&gt;%</span></span>
<span id="cb44-12"><a href="db-structure.html#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span></span>
<span id="cb44-13"><a href="db-structure.html#cb44-13" aria-hidden="true" tabindex="-1"></a>           season <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;Spring&quot;</span>, <span class="st">&quot;Autumn&quot;</span>))</span>
<span id="cb44-14"><a href="db-structure.html#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="db-structure.html#cb44-15" aria-hidden="true" tabindex="-1"></a>p_2013 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-16"><a href="db-structure.html#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> transition_2013, </span>
<span id="cb44-17"><a href="db-structure.html#cb44-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> season, <span class="at">color =</span> season),</span>
<span id="cb44-18"><a href="db-structure.html#cb44-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb44-19"><a href="db-structure.html#cb44-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> season_2013, </span>
<span id="cb44-20"><a href="db-structure.html#cb44-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> season, <span class="at">color =</span> season)) <span class="sc">+</span></span>
<span id="cb44-21"><a href="db-structure.html#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-22"><a href="db-structure.html#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb44-23"><a href="db-structure.html#cb44-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;2013 Home Ranges&quot;</span>,</span>
<span id="cb44-24"><a href="db-structure.html#cb44-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb44-25"><a href="db-structure.html#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="db-structure.html#cb44-26" aria-hidden="true" tabindex="-1"></a>p_2014 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-27"><a href="db-structure.html#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> transition_2014, </span>
<span id="cb44-28"><a href="db-structure.html#cb44-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> season, <span class="at">color =</span> season),</span>
<span id="cb44-29"><a href="db-structure.html#cb44-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb44-30"><a href="db-structure.html#cb44-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> season_2014, </span>
<span id="cb44-31"><a href="db-structure.html#cb44-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> season, <span class="at">color =</span> season)) <span class="sc">+</span></span>
<span id="cb44-32"><a href="db-structure.html#cb44-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-33"><a href="db-structure.html#cb44-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb44-34"><a href="db-structure.html#cb44-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;2014 Home Ranges&quot;</span>,</span>
<span id="cb44-35"><a href="db-structure.html#cb44-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb44-36"><a href="db-structure.html#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="db-structure.html#cb44-37" aria-hidden="true" tabindex="-1"></a>p_2013 <span class="sc">|</span> p_2014</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/plot_all-1.png" width="672" /></p>
<div id="home-range-area" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Home Range Area</h3>
<p>I can use a similar approach to make a data frame of areas of the home ranges using the function <code>hr_area</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="db-structure.html#cb45-1" aria-hidden="true" tabindex="-1"></a>hr_area <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(locoh), <span class="cf">function</span>(y){</span>
<span id="cb45-2"><a href="db-structure.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  hr_yr <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(locoh[[y]]), <span class="cf">function</span>(s){</span>
<span id="cb45-3"><a href="db-structure.html#cb45-3" aria-hidden="true" tabindex="-1"></a>    seasons <span class="ot">&lt;-</span> <span class="fu">names</span>(locoh[[y]])</span>
<span id="cb45-4"><a href="db-structure.html#cb45-4" aria-hidden="true" tabindex="-1"></a>    hr <span class="ot">&lt;-</span> locoh[[y]][[s]] <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="db-structure.html#cb45-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hr_area</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="db-structure.html#cb45-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb45-7"><a href="db-structure.html#cb45-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> years[y],</span>
<span id="cb45-8"><a href="db-structure.html#cb45-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">season =</span> seasons[s])</span>
<span id="cb45-9"><a href="db-structure.html#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(hr)</span>
<span id="cb45-10"><a href="db-structure.html#cb45-10" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb45-11"><a href="db-structure.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb45-12"><a href="db-structure.html#cb45-12" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> </span>
<span id="cb45-13"><a href="db-structure.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<p>How does total home range area differ by year?</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="db-structure.html#cb46-1" aria-hidden="true" tabindex="-1"></a>hr_area <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="db-structure.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">&lt;</span> <span class="fu">quantile</span>(hr_area<span class="sc">$</span>area, .<span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="db-structure.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> area)) <span class="sc">+</span></span>
<span id="cb46-4"><a href="db-structure.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="db-structure.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> season), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="db-structure.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Area (m^2)&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb46-7"><a href="db-structure.html#cb46-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;MD13F0001 Home Range Area by Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-8"><a href="db-structure.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/yr_area-1.png" width="672" /></p>
<p>How does total summer area compare with total winter area?</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="db-structure.html#cb47-1" aria-hidden="true" tabindex="-1"></a>hr_area <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="db-structure.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">&lt;</span> <span class="fu">quantile</span>(hr_area<span class="sc">$</span>area, .<span class="dv">8</span>) <span class="sc">&amp;</span></span>
<span id="cb47-3"><a href="db-structure.html#cb47-3" aria-hidden="true" tabindex="-1"></a>           season <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;Winter&quot;</span>, <span class="st">&quot;Summer&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="db-structure.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> area)) <span class="sc">+</span></span>
<span id="cb47-5"><a href="db-structure.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="db-structure.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> year), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb47-7"><a href="db-structure.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Area (m^2)&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb47-8"><a href="db-structure.html#cb47-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;MD13F0001 Home Range Area by Seasons&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-9"><a href="db-structure.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/season_area-1.png" width="672" /></p>
<p>How do the seasonal areas change by year?</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="db-structure.html#cb48-1" aria-hidden="true" tabindex="-1"></a>hr_area <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="db-structure.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">&lt;</span> <span class="fu">quantile</span>(hr_area<span class="sc">$</span>area, .<span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="db-structure.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(season, </span>
<span id="cb48-4"><a href="db-structure.html#cb48-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Winter&quot;</span>, <span class="st">&quot;Spring&quot;</span>, <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Autumn&quot;</span>)), <span class="at">y =</span> area,</span>
<span id="cb48-5"><a href="db-structure.html#cb48-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb48-6"><a href="db-structure.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb48-7"><a href="db-structure.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Area (m^2)&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb48-8"><a href="db-structure.html#cb48-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;MD13F0001 Home Range Area by Season&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="db-structure.html#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Bookdown_files/figure-html/area_all-1.png" width="672" /></p>
<p><br>
Burt, W.H. (1943). Territoriality and home range concepts as applied
to mammals. J. Mammal., 24, 346.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="overview.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Bookdown.pdf", "Bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
